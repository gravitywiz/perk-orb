description: >
  Run Cypress E2E tests.

executor: default

parameters:
  gf-version:
    type: enum
    description: >
      The release channel of Gravity Forms to use for the tests.
    enum: [ "hotfix", "beta", "auto-update", "2.4" ]
  run-yarn-build:
    type: boolean
    description: >
      Whether or not to run yarn build.
    default: true
  after-deps:
    description: "Steps that will be executed after dependencies are installed, but before tests are run"
    type: steps
    default: [ ]

steps:
  - checkout
  - install-yarn-deps
  - git-clone-gravityforms:
      version: << parameters.gf-version >>
  - git-clone-perk:
      perk: gravityperks
  - when:
      condition:
        equal: [ true, << parameters.run-yarn-build >> ]
      steps:
        - run: |
            yarn build
  - steps: << parameters.after-deps >>
  - run-cypress-tests:
      gf-version: << parameters.gf-version >>
